---
- name: Parse libvirt default network configuration
  command: virsh net-dumpxml default
  register: default_net_xml

- set_fact:
    bridge_dict: "{{ default_net_xml['stdout'] | ovirt.ovirt.get_bridge_xml_to_dict }}"

- template:
    src: templates/network-config.j2
    dest: /tmp/he-network-config.xml

- name: Update libvirt default network configuration, destroy
  command: virsh net-destroy default

- name: Update libvirt default network configuration, undefine
  command: virsh net-undefine default
  ignore_errors: true

- name: Update libvirt default network configuration, define
  command: virsh net-define --file /tmp/he-network-config.xml

- name: Activate default libvirt network
  command: virsh net-start default
